<form [formGroup]="form" (ngSubmit)="onSubmit()" class="container">
  <section class="section" *ngIf="currentStep === 0 && !isLoading && !isSuccess && !isServerError">
    <header class="section__header">
      <mat-icon routerLink="/dashboard" class="section__icon">close</mat-icon>
      <h1 class="section__title">Escaneie o <strong>QR Code</strong> do equipamento</h1>
      <p class="section__subtitle">Posicione o QR Code dentro da √°rea de leitura</p>
    </header>

    <div class="section__content section__content--scanner">

      <div class="section__scanner">
        <video #videoElement class="section__video" playsinline></video>
        <canvas #canvasElement class="section__canvas"></canvas>
        <div class="section__scanner-overlay">
          <div class="section__scanner-frame"></div>
        </div>
      </div>

      <div class="section__error" *ngIf="scanError">
        <mat-icon class="section__icon--error">error_outline</mat-icon>
        <p class="section__subtitle">{{ scanError }}</p>
      </div>
    </div>

    <footer class="section__footer">
      <button type="button" *ngIf="!isScanning" (click)="startScanning()" class="section__button">
        <mat-icon>qr_code_scanner</mat-icon>
        Iniciar Escaneamento
      </button>

      <button type="button" *ngIf="isScanning" (click)="stopScanning()"
        class="section__button section__button--secondary">
        Cancelar
      </button>
    </footer>
  </section>

  <section class="section" *ngIf="currentStep === 1 && !isLoading && !isSuccess && !isServerError">
    <header class="section__header">
      <mat-icon (click)="prevStep()" class="section__icon">arrow_back_ios_new</mat-icon>
      <h1 class="section__title">Informe o <strong>CEP</strong> da obra</h1>
    </header>

    <div>
      <label class="section__label">
        Informe o CEP

        <input type="number" formControlName="cep" placeholder="00000-000" enterkeyhint="next"
          (keydown.enter)="$event.preventDefault(); nextStep()" class="section__input">
      </label>
    </div>

    <footer class="section__footer">
      <button type="button" (click)="nextStep()" [disabled]="!form.get('cep')?.valid" class="section__button">
        Continuar
      </button>
    </footer>
  </section>

  <section class="section" *ngIf="currentStep === 2 && !isLoading && !isSuccess && !isServerError">
    <header class="section__header">
      <mat-icon (click)="prevStep()" class="section__icon">arrow_back_ios_new</mat-icon>
      <h1 class="section__title">Informe o <strong>n√∫mero</strong> da obra</h1>
    </header>

    <div>
      <label class="section__label">
        Insira o n√∫mero

        <input type="number" formControlName="numero" placeholder="0000" enterkeyhint="send" class="section__input">
      </label>

      <!-- ‚Üê Feedback de localiza√ß√£o -->
      <p class="section__subtitle" *ngIf="!locationLoaded" style="color: orange; margin-top: 8px;">
        üìç Obtendo sua localiza√ß√£o...
      </p>
    </div>

    <footer class="section__footer">
      <button type="submit" [disabled]="!form.get('numero')?.valid || !locationLoaded" class="section__button">
        Enviar
      </button>
    </footer>
  </section>

  <section class="section" *ngIf="isLoading && !isSuccess && !isServerError">
    <div class="loading">
      <div class="loading__dot"></div>
      <div class="loading__dot"></div>
      <div class="loading__dot"></div>
    </div>
  </section>

  <section class="section" *ngIf="isSuccess && !isLoading && !isServerError">
    <header class="section__header">
      <mat-icon routerLink="/dashboard" class="section__icon">close</mat-icon>
    </header>

    <div class="section__content section__content--status">
      <img [src]="successIllustration" class="section__image">
      <h3 class="section__title">Show de bola!</h3>
      <p class="section__subtitle">
        Sua solicita√ß√£o foi enviado com sucesso e ser√° analisada pelo setor respons√°vel. Miss√£o quase completa!
      </p>
    </div>

    <footer class="section__footer">
      <button type="button" routerLink="/dashboard" class="section__button">In√≠cio</button>
    </footer>
  </section>

  <section class="section" *ngIf="isServerError && !isLoading && !isSuccess">
    <header class="section__header">
      <mat-icon routerLink="/dashboard" class="section__icon">close</mat-icon>
    </header>

    <div class="section__content section__content--status">
      <img [src]="serverErrorIllustration" class="section__image">
      <h3 class="section__title">N√£o pode ser...!</h3>
      <p class="section__subtitle">
        Parece que nosso servidor n√£o est√° funcionando como deveria. Por favor, tente outra hora!
      </p>
    </div>

    <footer class="section__footer">
      <button type="button" routerLink="/dashboard" class="section__button">Sair</button>
    </footer>
  </section>
</form>
