<div class="container">
  <!-- ========================================
    HEADER
  ======================================== -->
  <header class="header">
    <button
      type="button"
      class="header__button"
      (click)="onNavigationBack()"
      aria-label="Voltar">
      <mat-icon>exit_to_app</mat-icon>
    </button>
    <h2 class="header__title">{{ title }}</h2>
  </header>

  <!-- ========================================
    LOADING STATE
  ======================================== -->
  <div class="viewport" *ngIf="isLoading">
    <div class="spinner" role="status" aria-label="Carregando"></div>
  </div>

  <!-- ========================================
    CARDS LIST
  ======================================== -->
  <div class="cards" *ngIf="!isLoading && !isEmpty">
    <div
      class="card"
      *ngFor="let item of data; trackBy: trackByFn"
      role="button"
      tabindex="0"
      [attr.aria-label]="'Abrir detalhes'"
      (click)="onCardClick(item)"
      (keydown.enter)="onCardClick(item)"
      (keydown.space)="$event.preventDefault(); onCardClick(item)">

      <!-- IMAGEM -->
      <div class="card__media">
        <img
          *ngIf="item['foto']"
          class="card__image"
          [src]="getImageUrl(item['foto'])"
          [alt]="item['name'] || 'Imagem do item'" />

        <mat-icon *ngIf="!item['foto']" class="card__icon">
          {{ iconCard }}
        </mat-icon>
      </div>

      <!-- INFORMAÇÕES DO CARD -->
      <div class="card__info">
        <ng-container *ngFor="let field of fields">
          <div
            class="card__field"
            *ngIf="isDataField(field) && field.style === 'card'">
            <label class="card__title">{{ field.label }}</label>
            <p class="card__subtitle">
              <ng-container [ngSwitch]="field.type">
                <ng-container *ngSwitchCase="'date'">
                  {{ item[field.name] | date:'dd/MM/yyyy' }}
                </ng-container>
                <ng-container *ngSwitchDefault>
                  {{ item[field.name] }}
                </ng-container>
              </ng-container>
            </p>
          </div>
        </ng-container>
      </div>
    </div>
  </div>

  <!-- ========================================
    EMPTY STATE
  ======================================== -->
  <div class="viewport" *ngIf="isEmpty && !isLoading">
    <mat-icon class="viewport__icon" aria-hidden="true">search_off</mat-icon>
    <h2 class="viewport__text">Nenhum resultado foi encontrado!</h2>
  </div>

  <!-- ========================================
    OVERLAY (BOTTOM SHEET + MODALS)
  ======================================== -->
  <div
    class="overlay"
    *ngIf="modalState !== ModalType.IDLE || isBottomSheetOpen"
    (click)="modalState !== ModalType.IDLE ? closeModal() : closeBottomSheet()">

    <!-- BOTTOM SHEET -->
    <div
      class="bottom-sheet"
      *ngIf="isBottomSheetOpen"
      [class.bottom-sheet--open]="isBottomSheetOpen"
      role="dialog"
      aria-modal="true"
      [attr.aria-label]="'Detalhes do item'"
      (click)="$event.stopPropagation()">

      <div class="bottom-sheet__content">
        <div class="bottom-sheet__info" *ngIf="selectedItem">

          <!-- CAMPOS DE DADOS -->
          <ng-container *ngFor="let field of fields">
            <div
              class="bottom-sheet__field"
              *ngIf="isDataField(field) && field.style === 'bottomSheet'">
              <label class="bottom-sheet__label">{{ field.label }}</label>
              <p class="bottom-sheet__value">
                <ng-container [ngSwitch]="field.type">
                  <ng-container *ngSwitchCase="'date'">
                    {{ selectedItem[field.name] | date:'dd/MM/yyyy' }}
                  </ng-container>
                  <ng-container *ngSwitchDefault>
                    {{ selectedItem[field.name] }}
                  </ng-container>
                </ng-container>
              </p>
            </div>
          </ng-container>

          <!-- BOTÕES DE AÇÃO -->
          <div class="bottom-sheet__actions">
            <ng-container *ngFor="let field of fields">
              <button
                class="bottom-sheet__button"
                *ngIf="isButtonField(field) && field.style === 'bottomSheet'"
                type="button"
                (click)="onActionClick(field.action)">
                {{ field.name }}
              </button>
            </ng-container>
          </div>
        </div>
      </div>
    </div>

    <!-- MODAL DE LOADING -->
    <div
      *ngIf="modalState === ModalType.LOADING"
      class="loading"
      role="alert"
      aria-live="polite"
      (click)="$event.stopPropagation()">
      <div class="loading__spinner"></div>
      <p class="loading__title">{{ modalMessage || 'Processando...' }}</p>
    </div>

    <!-- MODAL DE SUCESSO -->
    <div
      class="modal"
      *ngIf="modalState === ModalType.SUCCESS"
      role="alertdialog"
      aria-modal="true"
      [attr.aria-label]="modalMessage"
      (click)="$event.stopPropagation()">
      <div class="modal__icon modal__icon-success">
        <mat-icon>check</mat-icon>
      </div>
      <h3 class="modal__title">{{ modalMessage }}</h3>
      <button
        type="button"
        (click)="closeModal()"
        class="modal__button modal__button-success">
        Fechar
      </button>
    </div>

    <!-- MODAL DE ERRO -->
    <div
      class="modal"
      *ngIf="modalState === ModalType.ERROR"
      role="alertdialog"
      aria-modal="true"
      [attr.aria-label]="modalMessage"
      (click)="$event.stopPropagation()">
      <div class="modal__icon modal__icon-error">
        <mat-icon>block</mat-icon>
      </div>
      <h3 class="modal__title">{{ modalMessage }}</h3>
      <button
        type="button"
        (click)="closeModal()"
        class="modal__button modal__button-error">
        Tentar novamente
      </button>
    </div>
  </div>
</div>
